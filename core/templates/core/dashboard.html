{% extends 'base.html' %}
{% load static %}
{% load custom_filters %} {# Assuming you have custom filters, otherwise remove this line #}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2 class="mb-4">Welcome, {{ user.username }}!</h2>
<h3 class="mb-3">Your Email Classification History</h3>

{% if classifications %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                <th>Timestamp</th>
                <th>Email Snippet</th>
                <th>Classified As</th>
                <th>Confidence</th>
                <th>Feedback</th>
            </tr>
        </thead>
        <tbody>
            {% for classification in classifications %}
            <tr>
                <td>{{ classification.timestamp|date:"Y-m-d H:i" }}</td>
                <td>{{ classification.email_text|truncatechars:100 }}</td>
                <td>
                    <span class="badge {% if classification.classified_as == 'spam' %}badge-danger{% else %}badge-success{% endif %}">
                        {{ classification.classified_as|upper }}
                    </span>
                </td>
                <td>{{ classification.prediction_confidence|mul:100|floatformat:2 }}%</td> {# Ensure this filter exists or use JS if needed #}
                <td>
                    {% if classification.is_feedback_provided %}
                        <span class="badge badge-info">Provided</span>
                    {% else %}
                        <span class="badge badge-warning">Pending</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# Pagination Controls #}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if classifications.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ classifications.previous_page_number }}">Previous</a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
        {% endif %}

        {% for i in classifications.paginator.page_range %}
            {% if classifications.number == i %}
                <li class="page-item active"><span class="page-link">{{ i }}</span></li>
            {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
        {% endfor %}

        {% if classifications.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ classifications.next_page_number }}">Next</a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">Next</span>
            </li>
        {% endif %}
    </ul>
</nav>

{% else %}
<div class="alert alert-info" role="alert">
    You haven't classified any emails yet. Go to <a href="{% url 'classify_email' %}">Classify Email</a> to get started!
</div>
{% endif %}

<h3 class="mt-5 mb-3">Customization & Spam Filter Settings (Conceptual)</h3>
<div class="card">
    <div class="card-body">
        <p>Here, users could define custom rules, e.g., "Always block emails from example.com" or "Never classify emails containing 'invoice' as spam." This would involve backend logic to store and apply these rules. [1, 4]</p>
        <form>
            <div class="form-group">
                <label for="blacklistSender">Blacklist Sender (e.g., spammer@example.com):</label>
                <input type="email" class="form-control" id="blacklistSender" placeholder="Enter email address to block">
            </div>
            <div class="form-group">
                <label for="whitelistDomain">Whitelist Domain (e.g., mycompany.com):</label>
                <input type="text" class="form-control" id="whitelistDomain" placeholder="Enter ">
                {# ... Rest of your form fields ... #}
            </div>
        </form>
    </div>
</div>
{% endblock %}